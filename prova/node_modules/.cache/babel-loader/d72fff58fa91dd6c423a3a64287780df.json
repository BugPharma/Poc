{"ast":null,"code":"import * as d3 from 'd3';\nexport let arrayFinale;\nlet checkbox = []; //----------------------ELABORAZIONE MANUALE----------------------\n\nfunction buttonElaborate() {\n  const input = document.getElementById(\"csvFile\");\n  const file = input.files[0];\n  document.querySelector(\"#bottone-input-druid\").style.display = \"none\";\n  const reader = new FileReader();\n\n  reader.onload = function (e) {\n    const text = e.target.result; //stringa con tutto il risultato del file CSV\n\n    const data = csvToArray(text);\n    arrayFinale = transformArray(data);\n    manipulationDom();\n  };\n\n  reader.readAsText(file);\n} //----------------------ELABORAZIONE AI CON DRUID----------------------\n\n\nfunction buttonElaborateDruid() {\n  const input = document.getElementById(\"csvFile\");\n  const file = input.files[0];\n  const reader = new FileReader();\n\n  reader.onload = function (e) {\n    const text = e.target.result; //stringa con tutto il risultato del file CSV\n\n    const data = csvToArray(text);\n    druid(data);\n  };\n\n  reader.readAsText(file);\n}\n\nfunction isNumeric(n) {\n  return !isNaN(n);\n} // per tirare fuori solo i dati numerici\n\n\nexport function transformArray(data) {\n  data.forEach((elt, index) => {\n    if (index != 0) {\n      elt.forEach((elt2, index2) => {\n        if (isNumeric(elt2)) {\n          data[index][index2] = Number(elt2);\n        }\n      });\n    }\n  });\n  return data;\n}\nexport function manipulationDom() {\n  document.querySelector(\"#perCsv\").style.display = \"none\";\n  document.querySelector(\"#bottone-input\").style.display = \"none\";\n  arrayFinale[1].forEach((elt, index) => {\n    if (isNumeric(elt)) {\n      checkbox.push(arrayFinale[0][index]);\n    }\n  }); //creare i checkbox\n\n  createCheckBox(checkbox);\n  fine();\n}\n\nfunction createCheckBox(checkbox) {\n  var parentElement = document.querySelector('#myForm');\n  let counter = 0;\n  let spazio = document.createElement('br');\n\n  for (var count in checkbox) {\n    var newCheckBox = document.createElement('input');\n    newCheckBox.type = 'checkbox';\n    newCheckBox.id = 'check' + count; // need unique Ids!\n\n    let spazio = document.createElement('br');\n    var newLabel = document.createElement('label');\n    newLabel.innerHTML = checkbox[count];\n    parentElement.appendChild(spazio);\n    parentElement.appendChild(newCheckBox);\n    parentElement.appendChild(newLabel);\n    counter++;\n  }\n\n  parentElement.appendChild(spazio);\n  var newButton = document.createElement('button');\n  newButton.innerHTML = \"Calcola\";\n  newButton.id = \"bottoneCalcoloFinale\";\n  newButton.classList.add(\"button\");\n  newButton.style.marginTop = \"10px\";\n  newButton.type = \"button\";\n  parentElement.appendChild(newButton);\n} // toglie la prima riga \n\n\nfunction trasformaArray(array) {\n  let headers = array.shift();\n  let arrayModificato = array.map(function (row) {\n    const el = headers.reduce(function (object, header, index) {\n      object[header] = row[index];\n      return object;\n    }, {});\n    return el;\n  });\n  return arrayModificato;\n}\n\nfunction fine() {\n  let arrayBoolean = [];\n  let cordX;\n  let cordY;\n  let x;\n  let y;\n\n  document.querySelector(\"#bottoneCalcoloFinale\").onclick = function () {\n    //controlla i 2 check\n    checkbox.forEach((elt, index) => {\n      arrayBoolean.push(document.querySelector(`#check${index}`).checked);\n    });\n    arrayBoolean.forEach((elt, index) => {\n      if (elt == true) {\n        if (cordX == undefined) {\n          cordX = index;\n        } else {\n          cordY = index;\n        }\n      }\n    });\n    let x = checkbox[cordX];\n    let y = checkbox[cordY];\n    arrayFinale[0].forEach((elt, index) => {\n      if (elt == x) {\n        cordX = index;\n      }\n\n      if (elt == y) {\n        cordY = index;\n      }\n    });\n    dataForD3(cordX, cordY, x, y);\n  };\n\n  function dataForD3(x, y, nameX, nameY) {\n    console.log(\"aa\", arrayFinale);\n    arrayFinale = deleteEmpty(arrayFinale);\n    let arrayD3 = [];\n    arrayFinale.forEach((elt, index) => {\n      let arrayTemp = [];\n      arrayTemp.push(arrayFinale[index][cordX]);\n      arrayTemp.push(arrayFinale[index][cordY]);\n      arrayD3.push(arrayTemp);\n    });\n    arrayD3 = trasformaArray(arrayD3);\n    console.log(arrayD3);\n    d3Construct(arrayD3, nameX, nameY);\n  }\n}\n\nfunction deleteEmpty(array) {\n  let localArray = [];\n  array.forEach((item, i) => {\n    if (item == 0) {} else {\n      localArray.push(item);\n    }\n  });\n  return localArray;\n} //--------------------------------------------DRUID-------------------------------------------------------------------\n\n\nfunction druid(data) {\n  data = transformArray(data);\n  data = trasformaArray(data);\n  data.pop(); //SISTEMARE\n\n  const attrs = Object.keys(data[0]).filter(a => {\n    console.log(typeof data[0][a]);\n    return typeof data[0][a] === \"number\";\n  });\n  const maxes = attrs.map(a => {\n    return d3.max(data, d => d[a]);\n  });\n  console.log(maxes);\n  let a = data.map(d => attrs.map((a, i) => d[a] / maxes[i]));\n  console.log(\"a\", a);\n  let projection = new druid.PCA(a).transform(); //transformate in 2 colonne\n\n  projection = formatArray(projection);\n  console.log(\"pro\", projection);\n  d3Construct(projection, \"x\", \"y\");\n}\n\nfunction formatArray(projection) {\n  let headers = [\"x\", \"y\"];\n  let arrayModificato = projection.map(function (row) {\n    const el = headers.reduce(function (object, header, index) {\n      object[header] = row[index];\n      return object;\n    }, {});\n    return el;\n  });\n  return arrayModificato;\n}\n\nfunction min(data, nameX) {\n  let min = data[0][nameX];\n  data.forEach((item, i) => {\n    if (item[nameX] < min) {\n      min = item[nameX];\n    }\n  });\n  console.log(min);\n  return min;\n}\n\nfunction max(data, nameX) {\n  let max = data[0][nameX];\n  data.forEach((item, i) => {\n    if (item[nameX] > max) {\n      max = item[nameX];\n    }\n  });\n  console.log(max);\n  return max;\n} //--------------------------------------------D3, PLOT CSV-------------------------------------------------------------------\n\n\nfunction d3Construct(data, nameX, nameY) {\n  console.log(\"data\", data);\n  console.log(\"x\", nameX);\n  console.log(\"y\", nameY);\n  document.querySelector(\"#contenitoreForm\").style.display = \"none\";\n  document.querySelector(\"#my_dataviz\").style.display = \"block\";\n  const margin = {\n    top: 10,\n    right: 30,\n    bottom: 30,\n    left: 60\n  },\n        width = 460 - margin.left - margin.right,\n        height = 400 - margin.top - margin.bottom; // append the svg object to the body of the page\n\n  const svg = d3.select(\"#my_dataviz\").append(\"svg\").attr(\"width\", width + margin.left + margin.right).attr(\"height\", height + margin.top + margin.bottom).append(\"g\").attr(\"transform\", `translate(${margin.left}, ${margin.top})`);\n  create(); //Read the data\n\n  function create() {\n    // Add X axis\n    const x = d3.scaleLinear().domain([min(data, nameX), max(data, nameX)]).range([0, width]);\n    svg.append(\"g\").attr(\"transform\", `translate(0, ${height})`).call(d3.axisBottom(x)); // Add Y axis\n\n    const y = d3.scaleLinear().domain([min(data, nameY), max(data, nameY)]).range([height, 0]);\n    svg.append(\"g\").call(d3.axisLeft(y)); // Add dots\n\n    svg.append('g').selectAll(\"dot\").data(data).join(\"circle\").attr(\"cx\", function (d) {\n      return x(d[nameX]);\n    }).attr(\"cy\", function (d) {\n      return y(d[nameY]);\n    }).attr(\"r\", 3.5).style(\"fill\", \"#69b3a2\");\n  }\n}","map":{"version":3,"sources":["/home/nicla/Scrivania/SWE/prova/src/control.js"],"names":["d3","arrayFinale","checkbox","buttonElaborate","input","document","getElementById","file","files","querySelector","style","display","reader","FileReader","onload","e","text","target","result","data","csvToArray","transformArray","manipulationDom","readAsText","buttonElaborateDruid","druid","isNumeric","n","isNaN","forEach","elt","index","elt2","index2","Number","push","createCheckBox","fine","parentElement","counter","spazio","createElement","count","newCheckBox","type","id","newLabel","innerHTML","appendChild","newButton","classList","add","marginTop","trasformaArray","array","headers","shift","arrayModificato","map","row","el","reduce","object","header","arrayBoolean","cordX","cordY","x","y","onclick","checked","undefined","dataForD3","nameX","nameY","console","log","deleteEmpty","arrayD3","arrayTemp","d3Construct","localArray","item","i","pop","attrs","Object","keys","filter","a","maxes","max","d","projection","PCA","transform","formatArray","min","margin","top","right","bottom","left","width","height","svg","select","append","attr","create","scaleLinear","domain","range","call","axisBottom","axisLeft","selectAll","join"],"mappings":"AAAA,OAAO,KAAKA,EAAZ,MAAoB,IAApB;AAEE,OAAO,IAAIC,WAAJ;AACP,IAAIC,QAAQ,GAAG,EAAf,C,CAKA;;AACA,SAASC,eAAT,GAA0B;AACxB,QAAMC,KAAK,GAAGC,QAAQ,CAACC,cAAT,CAAwB,SAAxB,CAAd;AACA,QAAMC,IAAI,GAAGH,KAAK,CAACI,KAAN,CAAY,CAAZ,CAAb;AACAH,EAAAA,QAAQ,CAACI,aAAT,CAAuB,sBAAvB,EAA+CC,KAA/C,CAAqDC,OAArD,GAA+D,MAA/D;AAEA,QAAMC,MAAM,GAAG,IAAIC,UAAJ,EAAf;;AAEAD,EAAAA,MAAM,CAACE,MAAP,GAAgB,UAAUC,CAAV,EAAa;AAC3B,UAAMC,IAAI,GAAGD,CAAC,CAACE,MAAF,CAASC,MAAtB,CAD2B,CACE;;AAC7B,UAAMC,IAAI,GAAGC,UAAU,CAACJ,IAAD,CAAvB;AACAf,IAAAA,WAAW,GAAGoB,cAAc,CAACF,IAAD,CAA5B;AACAG,IAAAA,eAAe;AAChB,GALD;;AAOAV,EAAAA,MAAM,CAACW,UAAP,CAAkBhB,IAAlB;AACD,C,CAED;;;AACA,SAASiB,oBAAT,GAA+B;AAC7B,QAAMpB,KAAK,GAAGC,QAAQ,CAACC,cAAT,CAAwB,SAAxB,CAAd;AACA,QAAMC,IAAI,GAAGH,KAAK,CAACI,KAAN,CAAY,CAAZ,CAAb;AAEA,QAAMI,MAAM,GAAG,IAAIC,UAAJ,EAAf;;AAEAD,EAAAA,MAAM,CAACE,MAAP,GAAgB,UAAUC,CAAV,EAAa;AAC3B,UAAMC,IAAI,GAAGD,CAAC,CAACE,MAAF,CAASC,MAAtB,CAD2B,CACE;;AAC7B,UAAMC,IAAI,GAAGC,UAAU,CAACJ,IAAD,CAAvB;AACAS,IAAAA,KAAK,CAACN,IAAD,CAAL;AACD,GAJD;;AAMAP,EAAAA,MAAM,CAACW,UAAP,CAAkBhB,IAAlB;AACD;;AAID,SAASmB,SAAT,CAAmBC,CAAnB,EAAsB;AAAE,SAAO,CAACC,KAAK,CAACD,CAAD,CAAb;AAAmB,C,CAE3C;;;AACA,OAAO,SAASN,cAAT,CAAwBF,IAAxB,EAA6B;AAClCA,EAAAA,IAAI,CAACU,OAAL,CAAa,CAACC,GAAD,EAAMC,KAAN,KAAe;AAC1B,QAAGA,KAAK,IAAI,CAAZ,EAAc;AACZD,MAAAA,GAAG,CAACD,OAAJ,CAAY,CAACG,IAAD,EAAMC,MAAN,KAAgB;AAC1B,YAAGP,SAAS,CAACM,IAAD,CAAZ,EAAmB;AACjBb,UAAAA,IAAI,CAACY,KAAD,CAAJ,CAAYE,MAAZ,IAAsBC,MAAM,CAACF,IAAD,CAA5B;AACD;AACF,OAJD;AAKD;AACF,GARD;AASA,SAAOb,IAAP;AACD;AAGD,OAAO,SAASG,eAAT,GAA0B;AAE/BjB,EAAAA,QAAQ,CAACI,aAAT,CAAuB,SAAvB,EAAkCC,KAAlC,CAAwCC,OAAxC,GAAkD,MAAlD;AACAN,EAAAA,QAAQ,CAACI,aAAT,CAAuB,gBAAvB,EAAyCC,KAAzC,CAA+CC,OAA/C,GAAyD,MAAzD;AAGAV,EAAAA,WAAW,CAAC,CAAD,CAAX,CAAe4B,OAAf,CAAuB,CAACC,GAAD,EAAMC,KAAN,KAAe;AACpC,QAAGL,SAAS,CAACI,GAAD,CAAZ,EAAkB;AAChB5B,MAAAA,QAAQ,CAACiC,IAAT,CAAclC,WAAW,CAAC,CAAD,CAAX,CAAe8B,KAAf,CAAd;AACD;AACF,GAJD,EAN+B,CAY/B;;AACAK,EAAAA,cAAc,CAAClC,QAAD,CAAd;AAEAmC,EAAAA,IAAI;AACL;;AAED,SAASD,cAAT,CAAwBlC,QAAxB,EAAiC;AAE/B,MAAIoC,aAAa,GAAGjC,QAAQ,CAACI,aAAT,CAAuB,SAAvB,CAApB;AACA,MAAI8B,OAAO,GAAG,CAAd;AACA,MAAIC,MAAM,GAAGnC,QAAQ,CAACoC,aAAT,CAAuB,IAAvB,CAAb;;AAEA,OAAI,IAAIC,KAAR,IAAiBxC,QAAjB,EACA;AACE,QAAIyC,WAAW,GAAGtC,QAAQ,CAACoC,aAAT,CAAuB,OAAvB,CAAlB;AACAE,IAAAA,WAAW,CAACC,IAAZ,GAAmB,UAAnB;AACAD,IAAAA,WAAW,CAACE,EAAZ,GAAiB,UAAUH,KAA3B,CAHF,CAGoC;;AAElC,QAAIF,MAAM,GAAGnC,QAAQ,CAACoC,aAAT,CAAuB,IAAvB,CAAb;AAEA,QAAIK,QAAQ,GAAGzC,QAAQ,CAACoC,aAAT,CAAuB,OAAvB,CAAf;AACAK,IAAAA,QAAQ,CAACC,SAAT,GAAqB7C,QAAQ,CAACwC,KAAD,CAA7B;AAEAJ,IAAAA,aAAa,CAACU,WAAd,CAA0BR,MAA1B;AACAF,IAAAA,aAAa,CAACU,WAAd,CAA0BL,WAA1B;AACAL,IAAAA,aAAa,CAACU,WAAd,CAA0BF,QAA1B;AACAP,IAAAA,OAAO;AACR;;AAEDD,EAAAA,aAAa,CAACU,WAAd,CAA0BR,MAA1B;AACA,MAAIS,SAAS,GAAG5C,QAAQ,CAACoC,aAAT,CAAuB,QAAvB,CAAhB;AACAQ,EAAAA,SAAS,CAACF,SAAV,GAAsB,SAAtB;AACAE,EAAAA,SAAS,CAACJ,EAAV,GAAe,sBAAf;AACAI,EAAAA,SAAS,CAACC,SAAV,CAAoBC,GAApB,CAAwB,QAAxB;AACAF,EAAAA,SAAS,CAACvC,KAAV,CAAgB0C,SAAhB,GAA4B,MAA5B;AACAH,EAAAA,SAAS,CAACL,IAAV,GAAiB,QAAjB;AACAN,EAAAA,aAAa,CAACU,WAAd,CAA0BC,SAA1B;AACD,C,CAED;;;AACA,SAASI,cAAT,CAAwBC,KAAxB,EAA8B;AAC5B,MAAIC,OAAO,GAAGD,KAAK,CAACE,KAAN,EAAd;AACA,MAAIC,eAAe,GAAGH,KAAK,CAACI,GAAN,CAAU,UAAUC,GAAV,EAAe;AAC7C,UAAMC,EAAE,GAAGL,OAAO,CAACM,MAAR,CAAe,UAAUC,MAAV,EAAkBC,MAAlB,EAA0BhC,KAA1B,EAAiC;AACzD+B,MAAAA,MAAM,CAACC,MAAD,CAAN,GAAiBJ,GAAG,CAAC5B,KAAD,CAApB;AACA,aAAO+B,MAAP;AACD,KAHU,EAGR,EAHQ,CAAX;AAIA,WAAOF,EAAP;AACD,GANqB,CAAtB;AAOA,SAAOH,eAAP;AACD;;AAED,SAASpB,IAAT,GAAe;AACb,MAAI2B,YAAY,GAAG,EAAnB;AACA,MAAIC,KAAJ;AAAU,MAAIC,KAAJ;AACV,MAAIC,CAAJ;AAAM,MAAIC,CAAJ;;AACN/D,EAAAA,QAAQ,CAACI,aAAT,CAAuB,uBAAvB,EAAgD4D,OAAhD,GAA0D,YAAU;AAClE;AACAnE,IAAAA,QAAQ,CAAC2B,OAAT,CAAiB,CAACC,GAAD,EAAMC,KAAN,KAAc;AAC7BiC,MAAAA,YAAY,CAAC7B,IAAb,CAAmB9B,QAAQ,CAACI,aAAT,CAAwB,SAAQsB,KAAM,EAAtC,EAAyCuC,OAA5D;AACD,KAFD;AAGAN,IAAAA,YAAY,CAACnC,OAAb,CAAqB,CAACC,GAAD,EAAMC,KAAN,KAAc;AACjC,UAAGD,GAAG,IAAI,IAAV,EAAe;AACb,YAAGmC,KAAK,IAAIM,SAAZ,EAAsB;AACpBN,UAAAA,KAAK,GAAGlC,KAAR;AACD,SAFD,MAGI;AACFmC,UAAAA,KAAK,GAAGnC,KAAR;AACD;AACF;AACF,KATD;AAUA,QAAIoC,CAAC,GAAGjE,QAAQ,CAAC+D,KAAD,CAAhB;AACA,QAAIG,CAAC,GAAGlE,QAAQ,CAACgE,KAAD,CAAhB;AACAjE,IAAAA,WAAW,CAAC,CAAD,CAAX,CAAe4B,OAAf,CAAuB,CAACC,GAAD,EAAMC,KAAN,KAAc;AACnC,UAAGD,GAAG,IAAIqC,CAAV,EAAY;AACVF,QAAAA,KAAK,GAAGlC,KAAR;AACD;;AACD,UAAGD,GAAG,IAAIsC,CAAV,EAAY;AACVF,QAAAA,KAAK,GAAGnC,KAAR;AACD;AACF,KAPD;AAQAyC,IAAAA,SAAS,CAACP,KAAD,EAAQC,KAAR,EAAeC,CAAf,EAAkBC,CAAlB,CAAT;AACD,GA1BD;;AA6BA,WAASI,SAAT,CAAmBL,CAAnB,EAAsBC,CAAtB,EAAyBK,KAAzB,EAAgCC,KAAhC,EAAsC;AACpCC,IAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ,EAAiB3E,WAAjB;AACAA,IAAAA,WAAW,GAAG4E,WAAW,CAAC5E,WAAD,CAAzB;AACA,QAAI6E,OAAO,GAAG,EAAd;AACA7E,IAAAA,WAAW,CAAC4B,OAAZ,CAAoB,CAACC,GAAD,EAAMC,KAAN,KAAe;AACjC,UAAIgD,SAAS,GAAG,EAAhB;AACAA,MAAAA,SAAS,CAAC5C,IAAV,CAAelC,WAAW,CAAC8B,KAAD,CAAX,CAAmBkC,KAAnB,CAAf;AACAc,MAAAA,SAAS,CAAC5C,IAAV,CAAelC,WAAW,CAAC8B,KAAD,CAAX,CAAmBmC,KAAnB,CAAf;AACAY,MAAAA,OAAO,CAAC3C,IAAR,CAAa4C,SAAb;AACD,KALD;AAMAD,IAAAA,OAAO,GAAGzB,cAAc,CAACyB,OAAD,CAAxB;AACAH,IAAAA,OAAO,CAACC,GAAR,CAAYE,OAAZ;AACAE,IAAAA,WAAW,CAACF,OAAD,EAAUL,KAAV,EAAiBC,KAAjB,CAAX;AACD;AAGF;;AAED,SAASG,WAAT,CAAqBvB,KAArB,EAA2B;AACzB,MAAI2B,UAAU,GAAG,EAAjB;AACA3B,EAAAA,KAAK,CAACzB,OAAN,CAAc,CAACqD,IAAD,EAAOC,CAAP,KAAa;AACzB,QAAGD,IAAI,IAAI,CAAX,EAAc,CAAE,CAAhB,MACK;AACHD,MAAAA,UAAU,CAAC9C,IAAX,CAAgB+C,IAAhB;AACD;AACF,GALD;AAMA,SAAOD,UAAP;AACD,C,CAID;;;AAEA,SAASxD,KAAT,CAAeN,IAAf,EAAoB;AAClBA,EAAAA,IAAI,GAAGE,cAAc,CAACF,IAAD,CAArB;AACAA,EAAAA,IAAI,GAAGkC,cAAc,CAAClC,IAAD,CAArB;AACAA,EAAAA,IAAI,CAACiE,GAAL,GAHkB,CAGP;;AACX,QAAMC,KAAK,GAAGC,MAAM,CAACC,IAAP,CAAYpE,IAAI,CAAC,CAAD,CAAhB,EAAqBqE,MAArB,CACZC,CAAC,IAAI;AACHd,IAAAA,OAAO,CAACC,GAAR,CAAY,OAAOzD,IAAI,CAAC,CAAD,CAAJ,CAAQsE,CAAR,CAAnB;AACA,WAAQ,OAAOtE,IAAI,CAAC,CAAD,CAAJ,CAAQsE,CAAR,CAAP,KAAsB,QAA9B;AACD,GAJW,CAAd;AAMA,QAAMC,KAAK,GAAGL,KAAK,CAAC3B,GAAN,CAAU+B,CAAC,IAAI;AAC3B,WAAOzF,EAAE,CAAC2F,GAAH,CAAOxE,IAAP,EAAayE,CAAC,IAAIA,CAAC,CAACH,CAAD,CAAnB,CAAP;AACD,GAFa,CAAd;AAIAd,EAAAA,OAAO,CAACC,GAAR,CAAYc,KAAZ;AAEA,MAAID,CAAC,GAAGtE,IAAI,CAACuC,GAAL,CAASkC,CAAC,IAAIP,KAAK,CAAC3B,GAAN,CAAU,CAAC+B,CAAD,EAAIN,CAAJ,KAAUS,CAAC,CAACH,CAAD,CAAD,GAAOC,KAAK,CAACP,CAAD,CAAhC,CAAd,CAAR;AACAR,EAAAA,OAAO,CAACC,GAAR,CAAY,GAAZ,EAAgBa,CAAhB;AAEA,MAAII,UAAU,GAAG,IAAIpE,KAAK,CAACqE,GAAV,CAAcL,CAAd,EAAiBM,SAAjB,EAAjB,CAnBkB,CAmB4B;;AAG9CF,EAAAA,UAAU,GAAGG,WAAW,CAACH,UAAD,CAAxB;AACAlB,EAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ,EAAkBiB,UAAlB;AACAb,EAAAA,WAAW,CAACa,UAAD,EAAa,GAAb,EAAkB,GAAlB,CAAX;AACD;;AAED,SAASG,WAAT,CAAqBH,UAArB,EAAgC;AAC5B,MAAItC,OAAO,GAAG,CAAC,GAAD,EAAM,GAAN,CAAd;AACA,MAAIE,eAAe,GAAGoC,UAAU,CAACnC,GAAX,CAAe,UAAUC,GAAV,EAAe;AAClD,UAAMC,EAAE,GAAGL,OAAO,CAACM,MAAR,CAAe,UAAUC,MAAV,EAAkBC,MAAlB,EAA0BhC,KAA1B,EAAiC;AACzD+B,MAAAA,MAAM,CAACC,MAAD,CAAN,GAAiBJ,GAAG,CAAC5B,KAAD,CAApB;AACA,aAAO+B,MAAP;AACD,KAHU,EAGR,EAHQ,CAAX;AAIA,WAAOF,EAAP;AACD,GANqB,CAAtB;AAOA,SAAOH,eAAP;AACD;;AAEH,SAASwC,GAAT,CAAa9E,IAAb,EAAmBsD,KAAnB,EAAyB;AACvB,MAAIwB,GAAG,GAAG9E,IAAI,CAAC,CAAD,CAAJ,CAAQsD,KAAR,CAAV;AACAtD,EAAAA,IAAI,CAACU,OAAL,CAAa,CAACqD,IAAD,EAAOC,CAAP,KAAa;AACxB,QAAGD,IAAI,CAACT,KAAD,CAAJ,GAAcwB,GAAjB,EAAqB;AACnBA,MAAAA,GAAG,GAAGf,IAAI,CAACT,KAAD,CAAV;AACD;AACF,GAJD;AAKAE,EAAAA,OAAO,CAACC,GAAR,CAAYqB,GAAZ;AACA,SAAOA,GAAP;AACD;;AAED,SAASN,GAAT,CAAaxE,IAAb,EAAmBsD,KAAnB,EAAyB;AACvB,MAAIkB,GAAG,GAAGxE,IAAI,CAAC,CAAD,CAAJ,CAAQsD,KAAR,CAAV;AACAtD,EAAAA,IAAI,CAACU,OAAL,CAAa,CAACqD,IAAD,EAAOC,CAAP,KAAa;AACxB,QAAGD,IAAI,CAACT,KAAD,CAAJ,GAAckB,GAAjB,EAAqB;AACnBA,MAAAA,GAAG,GAAGT,IAAI,CAACT,KAAD,CAAV;AACD;AACF,GAJD;AAKAE,EAAAA,OAAO,CAACC,GAAR,CAAYe,GAAZ;AACA,SAAOA,GAAP;AACD,C,CAGD;;;AAGA,SAASX,WAAT,CAAqB7D,IAArB,EAA2BsD,KAA3B,EAAkCC,KAAlC,EAAwC;AAEtCC,EAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ,EAAoBzD,IAApB;AACAwD,EAAAA,OAAO,CAACC,GAAR,CAAY,GAAZ,EAAiBH,KAAjB;AACAE,EAAAA,OAAO,CAACC,GAAR,CAAY,GAAZ,EAAiBF,KAAjB;AAEArE,EAAAA,QAAQ,CAACI,aAAT,CAAuB,kBAAvB,EAA2CC,KAA3C,CAAiDC,OAAjD,GAA2D,MAA3D;AACAN,EAAAA,QAAQ,CAACI,aAAT,CAAuB,aAAvB,EAAsCC,KAAtC,CAA4CC,OAA5C,GAAsD,OAAtD;AAGA,QAAMuF,MAAM,GAAG;AAACC,IAAAA,GAAG,EAAE,EAAN;AAAUC,IAAAA,KAAK,EAAE,EAAjB;AAAqBC,IAAAA,MAAM,EAAE,EAA7B;AAAiCC,IAAAA,IAAI,EAAE;AAAvC,GAAf;AAAA,QACAC,KAAK,GAAG,MAAML,MAAM,CAACI,IAAb,GAAoBJ,MAAM,CAACE,KADnC;AAAA,QAEAI,MAAM,GAAG,MAAMN,MAAM,CAACC,GAAb,GAAmBD,MAAM,CAACG,MAFnC,CAVsC,CActC;;AACA,QAAMI,GAAG,GAAGzG,EAAE,CAAC0G,MAAH,CAAU,aAAV,EACXC,MADW,CACJ,KADI,EAEXC,IAFW,CAEN,OAFM,EAEGL,KAAK,GAAGL,MAAM,CAACI,IAAf,GAAsBJ,MAAM,CAACE,KAFhC,EAGXQ,IAHW,CAGN,QAHM,EAGIJ,MAAM,GAAGN,MAAM,CAACC,GAAhB,GAAsBD,MAAM,CAACG,MAHjC,EAIXM,MAJW,CAIJ,GAJI,EAKXC,IALW,CAKN,WALM,EAKQ,aAAYV,MAAM,CAACI,IAAK,KAAIJ,MAAM,CAACC,GAAI,GAL/C,CAAZ;AAOAU,EAAAA,MAAM,GAtBgC,CAuBtC;;AACA,WAASA,MAAT,GAAiB;AAEf;AACA,UAAM1C,CAAC,GAAGnE,EAAE,CAAC8G,WAAH,GACTC,MADS,CACF,CAACd,GAAG,CAAC9E,IAAD,EAAOsD,KAAP,CAAJ,EAAmBkB,GAAG,CAACxE,IAAD,EAAOsD,KAAP,CAAtB,CADE,EAETuC,KAFS,CAEH,CAAE,CAAF,EAAKT,KAAL,CAFG,CAAV;AAGAE,IAAAA,GAAG,CAACE,MAAJ,CAAW,GAAX,EACCC,IADD,CACM,WADN,EACoB,gBAAeJ,MAAO,GAD1C,EAECS,IAFD,CAEMjH,EAAE,CAACkH,UAAH,CAAc/C,CAAd,CAFN,EANe,CAUf;;AACA,UAAMC,CAAC,GAAGpE,EAAE,CAAC8G,WAAH,GACTC,MADS,CACF,CAACd,GAAG,CAAC9E,IAAD,EAAOuD,KAAP,CAAJ,EAAmBiB,GAAG,CAACxE,IAAD,EAAOuD,KAAP,CAAtB,CADE,EAETsC,KAFS,CAEH,CAAER,MAAF,EAAU,CAAV,CAFG,CAAV;AAGAC,IAAAA,GAAG,CAACE,MAAJ,CAAW,GAAX,EACCM,IADD,CACMjH,EAAE,CAACmH,QAAH,CAAY/C,CAAZ,CADN,EAde,CAiBf;;AACAqC,IAAAA,GAAG,CAACE,MAAJ,CAAW,GAAX,EACCS,SADD,CACW,KADX,EAECjG,IAFD,CAEMA,IAFN,EAGCkG,IAHD,CAGM,QAHN,EAICT,IAJD,CAIM,IAJN,EAIY,UAAUhB,CAAV,EAAa;AAAE,aAAOzB,CAAC,CAACyB,CAAC,CAACnB,KAAD,CAAF,CAAR;AAAqB,KAJhD,EAKCmC,IALD,CAKM,IALN,EAKY,UAAUhB,CAAV,EAAa;AAAE,aAAOxB,CAAC,CAACwB,CAAC,CAAClB,KAAD,CAAF,CAAR;AAAqB,KALhD,EAMCkC,IAND,CAMM,GANN,EAMW,GANX,EAOClG,KAPD,CAOO,MAPP,EAOe,SAPf;AASD;AACF","sourcesContent":["import * as d3 from 'd3';\n\n  export let arrayFinale;\n  let checkbox = [];\n  \n\n  \n  \n  //----------------------ELABORAZIONE MANUALE----------------------\n  function buttonElaborate(){\n    const input = document.getElementById(\"csvFile\");\n    const file = input.files[0];\n    document.querySelector(\"#bottone-input-druid\").style.display = \"none\";\n  \n    const reader = new FileReader();\n  \n    reader.onload = function (e) {\n      const text = e.target.result;//stringa con tutto il risultato del file CSV\n      const data = csvToArray(text);\n      arrayFinale = transformArray(data);\n      manipulationDom();\n    };\n  \n    reader.readAsText(file);\n  }\n  \n  //----------------------ELABORAZIONE AI CON DRUID----------------------\n  function buttonElaborateDruid(){\n    const input = document.getElementById(\"csvFile\");\n    const file = input.files[0];\n  \n    const reader = new FileReader();\n  \n    reader.onload = function (e) {\n      const text = e.target.result;//stringa con tutto il risultato del file CSV\n      const data = csvToArray(text);\n      druid(data);\n    };\n  \n    reader.readAsText(file);\n  }\n  \n \n  \n  function isNumeric(n) { return !isNaN(n); }\n  \n  // per tirare fuori solo i dati numerici\n  export function transformArray(data){\n    data.forEach((elt, index) =>{\n      if(index != 0){\n        elt.forEach((elt2,index2) =>{\n          if(isNumeric(elt2)){\n            data[index][index2] = Number(elt2);\n          }\n        });\n      }\n    });\n    return data;\n  }\n  \n  \n  export function manipulationDom(){\n  \n    document.querySelector(\"#perCsv\").style.display = \"none\";\n    document.querySelector(\"#bottone-input\").style.display = \"none\";\n  \n  \n    arrayFinale[1].forEach((elt, index) =>{\n      if(isNumeric(elt)){\n        checkbox.push(arrayFinale[0][index]);\n      }\n    });\n  \n    //creare i checkbox\n    createCheckBox(checkbox);\n  \n    fine();\n  }\n  \n  function createCheckBox(checkbox){\n  \n    var parentElement = document.querySelector('#myForm');\n    let counter = 0;\n    let spazio = document.createElement('br');\n  \n    for(var count in checkbox)\n    {\n      var newCheckBox = document.createElement('input');\n      newCheckBox.type = 'checkbox';\n      newCheckBox.id = 'check' + count; // need unique Ids!\n  \n      let spazio = document.createElement('br');\n  \n      var newLabel = document.createElement('label');\n      newLabel.innerHTML = checkbox[count];\n  \n      parentElement.appendChild(spazio);\n      parentElement.appendChild(newCheckBox);\n      parentElement.appendChild(newLabel);\n      counter++;\n    }\n  \n    parentElement.appendChild(spazio);\n    var newButton = document.createElement('button');\n    newButton.innerHTML = \"Calcola\";\n    newButton.id = \"bottoneCalcoloFinale\";\n    newButton.classList.add(\"button\");\n    newButton.style.marginTop = \"10px\";\n    newButton.type = \"button\";\n    parentElement.appendChild(newButton);\n  }\n  \n  // toglie la prima riga \n  function trasformaArray(array){\n    let headers = array.shift();\n    let arrayModificato = array.map(function (row) {\n      const el = headers.reduce(function (object, header, index) {\n        object[header] = row[index];\n        return object;\n      }, {});\n      return el;\n    });\n    return arrayModificato;\n  }\n  \n  function fine(){\n    let arrayBoolean = [];\n    let cordX;let cordY;\n    let x;let y;\n    document.querySelector(\"#bottoneCalcoloFinale\").onclick = function(){\n      //controlla i 2 check\n      checkbox.forEach((elt, index)=>{\n        arrayBoolean.push((document.querySelector(`#check${index}`).checked));\n      });\n      arrayBoolean.forEach((elt, index)=>{\n        if(elt == true){\n          if(cordX == undefined){\n            cordX = index;\n          }\n          else{\n            cordY = index;\n          }\n        }\n      });\n      let x = checkbox[cordX];\n      let y = checkbox[cordY];\n      arrayFinale[0].forEach((elt, index)=>{\n        if(elt == x){\n          cordX = index;\n        }\n        if(elt == y){\n          cordY = index;\n        }\n      });\n      dataForD3(cordX, cordY, x, y);\n    }\n  \n  \n    function dataForD3(x, y, nameX, nameY){\n      console.log(\"aa\",arrayFinale);\n      arrayFinale = deleteEmpty(arrayFinale);\n      let arrayD3 = [];\n      arrayFinale.forEach((elt, index) =>{\n        let arrayTemp = [];\n        arrayTemp.push(arrayFinale[index][cordX]);\n        arrayTemp.push(arrayFinale[index][cordY]);\n        arrayD3.push(arrayTemp);\n      });\n      arrayD3 = trasformaArray(arrayD3);\n      console.log(arrayD3);\n      d3Construct(arrayD3, nameX, nameY);\n    }\n  \n  \n  }\n  \n  function deleteEmpty(array){\n    let localArray = [];\n    array.forEach((item, i) => {\n      if(item == 0) {}\n      else {\n        localArray.push(item);\n      }\n    });\n    return localArray;\n  }\n  \n  \n  \n  //--------------------------------------------DRUID-------------------------------------------------------------------\n  \n  function druid(data){\n    data = transformArray(data);\n    data = trasformaArray(data);\n    data.pop();//SISTEMARE\n    const attrs = Object.keys(data[0]).filter(\n      a => {\n        console.log(typeof data[0][a]);\n        return (typeof data[0][a] === \"number\");\n      }\n    );\n    const maxes = attrs.map(a => {\n      return d3.max(data, d => d[a]);\n    });\n  \n    console.log(maxes);\n  \n    let a = data.map(d => attrs.map((a, i) => d[a] / maxes[i]));\n    console.log(\"a\",a);\n  \n    let projection = new druid.PCA(a).transform();//transformate in 2 colonne\n  \n  \n    projection = formatArray(projection);\n    console.log(\"pro\",projection);\n    d3Construct(projection, \"x\", \"y\");\n  }\n  \n  function formatArray(projection){\n      let headers = [\"x\", \"y\"];\n      let arrayModificato = projection.map(function (row) {\n        const el = headers.reduce(function (object, header, index) {\n          object[header] = row[index];\n          return object;\n        }, {});\n        return el;\n      });\n      return arrayModificato;\n    }\n  \n  function min(data, nameX){\n    let min = data[0][nameX];\n    data.forEach((item, i) => {\n      if(item[nameX] < min){\n        min = item[nameX];\n      }\n    });\n    console.log(min);\n    return min;\n  }\n  \n  function max(data, nameX){\n    let max = data[0][nameX];\n    data.forEach((item, i) => {\n      if(item[nameX] > max){\n        max = item[nameX];\n      }\n    });\n    console.log(max);\n    return max;\n  }\n  \n  \n  //--------------------------------------------D3, PLOT CSV-------------------------------------------------------------------\n  \n  \n  function d3Construct(data, nameX, nameY){\n  \n    console.log(\"data\", data);\n    console.log(\"x\", nameX);\n    console.log(\"y\", nameY);\n  \n    document.querySelector(\"#contenitoreForm\").style.display = \"none\";\n    document.querySelector(\"#my_dataviz\").style.display = \"block\";\n  \n  \n    const margin = {top: 10, right: 30, bottom: 30, left: 60},\n    width = 460 - margin.left - margin.right,\n    height = 400 - margin.top - margin.bottom;\n  \n    // append the svg object to the body of the page\n    const svg = d3.select(\"#my_dataviz\")\n    .append(\"svg\")\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.top + margin.bottom)\n    .append(\"g\")\n    .attr(\"transform\", `translate(${margin.left}, ${margin.top})`);\n  \n    create();\n    //Read the data\n    function create(){\n  \n      // Add X axis\n      const x = d3.scaleLinear()\n      .domain([min(data, nameX), max(data, nameX)])\n      .range([ 0, width ]);\n      svg.append(\"g\")\n      .attr(\"transform\", `translate(0, ${height})`)\n      .call(d3.axisBottom(x));\n  \n      // Add Y axis\n      const y = d3.scaleLinear()\n      .domain([min(data, nameY), max(data, nameY)])\n      .range([ height, 0]);\n      svg.append(\"g\")\n      .call(d3.axisLeft(y));\n  \n      // Add dots\n      svg.append('g')\n      .selectAll(\"dot\")\n      .data(data)\n      .join(\"circle\")\n      .attr(\"cx\", function (d) { return x(d[nameX]); } )\n      .attr(\"cy\", function (d) { return y(d[nameY]); } )\n      .attr(\"r\", 3.5)\n      .style(\"fill\", \"#69b3a2\");\n  \n    }\n  }\n"]},"metadata":{},"sourceType":"module"}