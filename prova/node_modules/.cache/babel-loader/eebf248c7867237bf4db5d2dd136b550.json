{"ast":null,"code":"import * as d3 from 'd3';\nexport let arrayFinale;\nlet checkbox = [];\nexport let dataD3;\nexport let xAxis;\nexport let yAxis;\nexport var node = document.createElement('div'); //----------------------ELABORAZIONE MANUALE----------------------\n\n/*\nfunction buttonElaborate(){\n  const input = document.getElementById(\"csvFile\");\n  const file = input.files[0];\n  document.querySelector(\"#bottone-input-druid\").style.display = \"none\";\n\n  const reader = new FileReader();\n\n  reader.onload = function (e) {\n    const text = e.target.result;//stringa con tutto il risultato del file CSV\n    const data = csvToArray(text);\n    arrayFinale = transformArray(data);\n    manipulationDom();\n  };\n\n  reader.readAsText(file);\n}\n\n //----------------------ELABORAZIONE AI CON DRUID----------------------\nfunction buttonElaborateDruid(){\n  const input = document.getElementById(\"csvFile\");\n  const file = input.files[0];\n\n  const reader = new FileReader();\n\n  reader.onload = function (e) {\n    const text = e.target.result;//stringa con tutto il risultato del file CSV\n    const data = csvToArray(text);\n    druid(data);\n  };\n\n  reader.readAsText(file);\n}\n\n*/\n\nfunction isNumeric(n) {\n  return !isNaN(n);\n} // per fare qualcosa ai dati numerici\n\n\nexport function transformArray(data) {\n  data.forEach((elt, index) => {\n    // scorre le righe\n    if (index != 0) {\n      // salta la prima riga con le etichette\n      for (const key in data[index]) {\n        if (isNumeric(data[index][key])) data[index][key] = Number(data[index][key]);\n      }\n      /* Array.from(elt).forEach((elt2,index2) =>{ // scorre le colonne\n        if(isNumeric(elt2)){\n          data[index][index2] = Number(elt2); //che cacchio serve?\n        }\n      }); */\n\n    }\n  });\n  return data;\n}\nexport function manipulationDom(data) {\n  let riga = data[1];\n  document.querySelector(\"#csvFile\").style.display = \"none\"; //toglie la form per inserire il csv\n\n  document.querySelector(\"#bottone_elab\").style.display = \"none\"; //toglie il bottone per elaborare\n\n  for (const key in riga) {\n    //console.log(key, ' : ', riga[key]);\n    if (isNumeric(riga[key])) {\n      checkbox.push(key);\n    }\n  }\n\n  console.log(checkbox); //creare i checkbox\n\n  createCheckBox(checkbox);\n  fine(data);\n}\n\nfunction createCheckBox(checkbox) {\n  var parentElement = document.querySelector('#myForm');\n  let counter = 0;\n  let spazio = document.createElement('br');\n\n  for (var count in checkbox) {\n    var newCheckBox = document.createElement('input');\n    newCheckBox.type = 'checkbox';\n    newCheckBox.id = 'check' + count; // need unique Ids!\n\n    let spazio = document.createElement('br');\n    var newLabel = document.createElement('label');\n    newLabel.innerHTML = checkbox[count];\n    parentElement.appendChild(spazio);\n    parentElement.appendChild(newCheckBox);\n    parentElement.appendChild(newLabel);\n    counter++;\n  }\n\n  parentElement.appendChild(spazio);\n  var newButton = document.createElement('button');\n  newButton.innerHTML = \"Calcola\";\n  newButton.id = \"bottoneCalcoloFinale\";\n  newButton.classList.add(\"button\");\n  newButton.style.marginTop = \"10px\";\n  newButton.type = \"button\";\n  parentElement.appendChild(newButton);\n} // toglie la prima riga\n\n\nfunction trasformaArray(array) {\n  let headers = array.shift();\n  /* let arrayModificato = array.map(function (row) {\n    const el = headers.reduce(function (object, header, index) {\n      object[header] = row[index];\n      return object;\n    }, {});\n    return el;\n  }); */\n  //return arrayModificato;\n\n  return array;\n}\n\nfunction fine(data) {\n  let arrayBoolean = [];\n  let cordX;\n  let cordY;\n  let x;\n  let y;\n\n  document.querySelector(\"#bottoneCalcoloFinale\").onclick = function () {\n    //controlla i 2 check\n    checkbox.forEach((elt, index) => {\n      arrayBoolean.push(document.querySelector(`#check${index}`).checked);\n    });\n    arrayBoolean.forEach((elt, index) => {\n      if (elt == true) {\n        if (cordX == undefined) {\n          cordX = index;\n        } else {\n          cordY = index;\n        }\n      }\n    });\n    let x = checkbox[cordX];\n    let y = checkbox[cordY];\n    data[0].forEach((elt, index) => {\n      if (elt == x) {\n        cordX = index;\n      }\n\n      if (elt == y) {\n        cordY = index;\n      }\n    });\n    dataForD3(cordX, cordY, x, y, data);\n  }; //crea un array di punti\n\n\n  function dataForD3(x, y, nameX, nameY, data) {\n    console.log(\"aa\", data);\n    data = deleteEmpty(data);\n    let arrayD3 = [];\n    data.forEach((elt, index) => {\n      let arrayTemp = [];\n      arrayTemp.push(data[index][nameX]);\n      arrayTemp.push(data[index][nameY]);\n      arrayD3.push(arrayTemp);\n    });\n    console.log(\"arrayD3\", arrayD3); // per togliere la prima riga\n\n    arrayD3 = trasformaArray(arrayD3);\n    d3Construct(arrayD3, nameX, nameY);\n  }\n}\n\nfunction deleteEmpty(array) {\n  let localArray = [];\n  array.forEach((item, i) => {\n    if (item == 0) {} else {\n      localArray.push(item);\n    }\n  });\n  return localArray;\n} //--------------------------------------------DRUID-------------------------------------------------------------------\n\n\nfunction druid(data) {\n  data = transformArray(data);\n  data = trasformaArray(data);\n  data.pop(); //SISTEMARE\n\n  const attrs = Object.keys(data[0]).filter(a => {\n    console.log(typeof data[0][a]);\n    return typeof data[0][a] === \"number\";\n  });\n  const maxes = attrs.map(a => {\n    return d3.max(data, d => d[a]);\n  });\n  console.log(maxes);\n  let a = data.map(d => attrs.map((a, i) => d[a] / maxes[i]));\n  console.log(\"a\", a);\n  let projection = new druid.PCA(a).transform(); //transformate in 2 colonne\n\n  projection = formatArray(projection);\n  console.log(\"pro\", projection);\n  d3Construct(projection, \"x\", \"y\");\n}\n\nfunction formatArray(projection) {\n  let headers = [\"x\", \"y\"];\n  let arrayModificato = projection.map(function (row) {\n    const el = headers.reduce(function (object, header, index) {\n      object[header] = row[index];\n      return object;\n    }, {});\n    return el;\n  });\n  return arrayModificato;\n}\n\nfunction min(data, nameX) {\n  let min = data[0][nameX];\n  data.forEach((item, i) => {\n    if (item[nameX] < min) {\n      min = item[nameX];\n    }\n  });\n  console.log(min);\n  return min;\n}\n\nfunction max(data, nameX) {\n  let max = data[0][nameX];\n  data.forEach((item, i) => {\n    if (item[nameX] > max) {\n      max = item[nameX];\n    }\n  });\n  console.log(max);\n  return max;\n} //--------------------------------------------D3, PLOT CSV-------------------------------------------------------------------\n\n\nfunction d3Construct(data, nameX, nameY) {\n  console.log(\"data\", data);\n  console.log(\"x\", nameX);\n  console.log(\"y\", nameY); //per simulare un reindirezzamento\n\n  window.location.href = \"http://localhost:3000/result\";\n  var margin = {\n    top: 10,\n    right: 30,\n    bottom: 30,\n    left: 60\n  },\n      width = 460 - margin.left - margin.right,\n      height = 400 - margin.top - margin.bottom; // append the svg object to the body of the page\n\n  var svg = d3.select(node).append(\"svg\").attr(\"width\", width + margin.left + margin.right).attr(\"height\", height + margin.top + margin.bottom).append(\"g\").attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\"); //Read the data\n\n  d3.csv(dataD3, function (da) {\n    // Add X axis\n    var x = d3.scaleLinear().domain([0, 4000]).range([0, width]);\n    svg.append(\"g\").attr(\"transform\", \"translate(0,\" + height + \")\").call(d3.axisBottom(x)); // Add Y axis\n\n    var y = d3.scaleLinear().domain([0, 500000]).range([height, 0]);\n    svg.append(\"g\").call(d3.axisLeft(y)); // Add dots\n\n    svg.append(\"g\").selectAll(\"dot\").data(dataD3).enter().append(\"circle\").attr(\"cx\", function (d) {\n      return x(d.GrLivArea);\n    }).attr(\"cy\", function (d) {\n      return y(d.SalePrice);\n    }).attr(\"r\", 1.5).style(\"fill\", \"#69b3a2\");\n  });\n}","map":{"version":3,"sources":["/home/nicla/Scrivania/SWE/prova/src/control.js"],"names":["d3","arrayFinale","checkbox","dataD3","xAxis","yAxis","node","document","createElement","isNumeric","n","isNaN","transformArray","data","forEach","elt","index","key","Number","manipulationDom","riga","querySelector","style","display","push","console","log","createCheckBox","fine","parentElement","counter","spazio","count","newCheckBox","type","id","newLabel","innerHTML","appendChild","newButton","classList","add","marginTop","trasformaArray","array","headers","shift","arrayBoolean","cordX","cordY","x","y","onclick","checked","undefined","dataForD3","nameX","nameY","deleteEmpty","arrayD3","arrayTemp","d3Construct","localArray","item","i","druid","pop","attrs","Object","keys","filter","a","maxes","map","max","d","projection","PCA","transform","formatArray","arrayModificato","row","el","reduce","object","header","min","window","location","href","margin","top","right","bottom","left","width","height","svg","select","append","attr","csv","da","scaleLinear","domain","range","call","axisBottom","axisLeft","selectAll","enter","GrLivArea","SalePrice"],"mappings":"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","sourcesContent":["import * as d3 from 'd3';\n\n  export let arrayFinale;\n  let checkbox = [];\n  export let dataD3;\n  export let xAxis;\n  export let yAxis;\n  export var node = document.createElement('div');\n\n  \n  \n  //----------------------ELABORAZIONE MANUALE----------------------\n  /*\n  function buttonElaborate(){\n    const input = document.getElementById(\"csvFile\");\n    const file = input.files[0];\n    document.querySelector(\"#bottone-input-druid\").style.display = \"none\";\n  \n    const reader = new FileReader();\n  \n    reader.onload = function (e) {\n      const text = e.target.result;//stringa con tutto il risultato del file CSV\n      const data = csvToArray(text);\n      arrayFinale = transformArray(data);\n      manipulationDom();\n    };\n  \n    reader.readAsText(file);\n  }\n  \n\n  //----------------------ELABORAZIONE AI CON DRUID----------------------\n  function buttonElaborateDruid(){\n    const input = document.getElementById(\"csvFile\");\n    const file = input.files[0];\n  \n    const reader = new FileReader();\n  \n    reader.onload = function (e) {\n      const text = e.target.result;//stringa con tutto il risultato del file CSV\n      const data = csvToArray(text);\n      druid(data);\n    };\n  \n    reader.readAsText(file);\n  }\n  \n */\n  \n  function isNumeric(n) { return !isNaN(n); }\n  \n  // per fare qualcosa ai dati numerici\n  export function transformArray(data){\n    data.forEach((elt, index) =>{ // scorre le righe\n      if(index != 0){ // salta la prima riga con le etichette\n        for(const key in data[index]) {\n          if(isNumeric(data[index][key]))\n            data[index][key]=Number(data[index][key]);\n        }\n\n        /* Array.from(elt).forEach((elt2,index2) =>{ // scorre le colonne\n          if(isNumeric(elt2)){\n            data[index][index2] = Number(elt2); //che cacchio serve?\n          }\n        }); */\n      }\n    });\n    return data;\n  }\n  \n  \n  export function manipulationDom(data){\n    let riga=data[1];\n\n    document.querySelector(\"#csvFile\").style.display = \"none\"; //toglie la form per inserire il csv\n    document.querySelector(\"#bottone_elab\").style.display = \"none\"; //toglie il bottone per elaborare\n    \n\n    for (const key in riga) {\n      //console.log(key, ' : ', riga[key]);\n      if(isNumeric(riga[key])){\n        checkbox.push(key);\n      }\n    }\n\n    console.log(checkbox);\n\n    //creare i checkbox\n    createCheckBox(checkbox);\n  \n    fine(data);\n  }\n  \n\n  function createCheckBox(checkbox){ \n  \n    var parentElement = document.querySelector('#myForm');\n    let counter = 0;\n    let spazio = document.createElement('br');\n  \n    for(var count in checkbox)\n    {\n      var newCheckBox = document.createElement('input');\n      newCheckBox.type = 'checkbox';\n      newCheckBox.id = 'check' + count; // need unique Ids!\n  \n      let spazio = document.createElement('br');\n  \n      var newLabel = document.createElement('label');\n      newLabel.innerHTML = checkbox[count];\n  \n      parentElement.appendChild(spazio);\n      parentElement.appendChild(newCheckBox);\n      parentElement.appendChild(newLabel);\n      counter++;\n    }\n  \n    parentElement.appendChild(spazio);\n    var newButton = document.createElement('button');\n    newButton.innerHTML = \"Calcola\";\n    newButton.id = \"bottoneCalcoloFinale\";\n    newButton.classList.add(\"button\");\n    newButton.style.marginTop = \"10px\";\n    newButton.type = \"button\";\n    parentElement.appendChild(newButton);\n  }\n  \n\n  // toglie la prima riga\n  function trasformaArray(array){\n    let headers = array.shift(); \n    /* let arrayModificato = array.map(function (row) {\n      const el = headers.reduce(function (object, header, index) {\n        object[header] = row[index];\n        return object;\n      }, {});\n      return el;\n    }); */\n    \n    //return arrayModificato;\n    return array;\n  }\n  \n  function fine(data){\n    let arrayBoolean = [];\n    let cordX;let cordY;\n    let x;let y;\n    document.querySelector(\"#bottoneCalcoloFinale\").onclick = function(){\n      //controlla i 2 check\n      checkbox.forEach((elt, index)=>{\n        arrayBoolean.push((document.querySelector(`#check${index}`).checked));\n      });\n      arrayBoolean.forEach((elt, index)=>{\n        if(elt == true){\n          if(cordX == undefined){\n            cordX = index;\n          }\n          else{\n            cordY = index;\n          }\n        }\n      });\n      let x = checkbox[cordX];\n      let y = checkbox[cordY];\n      data[0].forEach((elt, index)=>{\n        if(elt == x){\n          cordX = index;\n        }\n        if(elt == y){\n          cordY = index;\n        }\n      });\n\n      dataForD3(cordX, cordY, x, y, data);\n      \n    }\n  \n    \n    //crea un array di punti\n    function dataForD3(x, y, nameX, nameY, data){\n      console.log(\"aa\",data);\n      data = deleteEmpty(data); \n      \n      let arrayD3 = [];\n      data.forEach((elt, index) =>{\n        let arrayTemp = [];\n        arrayTemp.push(data[index][nameX]);\n        arrayTemp.push(data[index][nameY]);\n        arrayD3.push(arrayTemp);\n      });\n\n      console.log(\"arrayD3\", arrayD3);\n      // per togliere la prima riga\n      arrayD3 = trasformaArray(arrayD3);\n      d3Construct(arrayD3, nameX, nameY);\n    }\n  \n  \n  }\n  \n  function deleteEmpty(array){\n    let localArray = [];\n    array.forEach((item, i) => {\n      if(item == 0) {}\n      else {\n        localArray.push(item);\n      }\n    });\n    return localArray;\n  }\n  \n  \n  \n  //--------------------------------------------DRUID-------------------------------------------------------------------\n  \n  function druid(data){\n    data = transformArray(data);\n    data = trasformaArray(data);\n    data.pop();//SISTEMARE\n    const attrs = Object.keys(data[0]).filter(\n      a => {\n        console.log(typeof data[0][a]);\n        return (typeof data[0][a] === \"number\");\n      }\n    );\n    const maxes = attrs.map(a => {\n      return d3.max(data, d => d[a]);\n    });\n  \n    console.log(maxes);\n  \n    let a = data.map(d => attrs.map((a, i) => d[a] / maxes[i]));\n    console.log(\"a\",a);\n  \n    let projection = new druid.PCA(a).transform();//transformate in 2 colonne\n  \n  \n    projection = formatArray(projection);\n    console.log(\"pro\",projection);\n    d3Construct(projection, \"x\", \"y\");\n  }\n  \n  function formatArray(projection){\n      let headers = [\"x\", \"y\"];\n      let arrayModificato = projection.map(function (row) {\n        const el = headers.reduce(function (object, header, index) {\n          object[header] = row[index];\n          return object;\n        }, {});\n        return el;\n      });\n      return arrayModificato;\n    }\n  \n  function min(data, nameX){\n    let min = data[0][nameX];\n    data.forEach((item, i) => {\n      if(item[nameX] < min){\n        min = item[nameX];\n      }\n    });\n    console.log(min);\n    return min;\n  }\n  \n  function max(data, nameX){\n    let max = data[0][nameX];\n    data.forEach((item, i) => {\n      if(item[nameX] > max){\n        max = item[nameX];\n      }\n    });\n    console.log(max);\n    return max;\n  }\n  \n  \n  //--------------------------------------------D3, PLOT CSV-------------------------------------------------------------------\n  \n  \nfunction d3Construct(data, nameX, nameY){\n  \n  console.log(\"data\", data);\n  console.log(\"x\", nameX);\n  console.log(\"y\", nameY);\n\n  //per simulare un reindirezzamento\n  window.location.href = \"http://localhost:3000/result\"\n\n\n\nvar margin = {top: 10, right: 30, bottom: 30, left: 60},\n    width = 460 - margin.left - margin.right,\n    height = 400 - margin.top - margin.bottom;\n \n// append the svg object to the body of the page\nvar svg = d3.select(node)\n  .append(\"svg\")\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.top + margin.bottom)\n  .append(\"g\")\n    .attr(\"transform\",\n          \"translate(\" + margin.left + \",\" + margin.top + \")\");\n \n//Read the data\nd3.csv(dataD3, function(da) {\n \n  // Add X axis\n  var x = d3.scaleLinear()\n    .domain([0, 4000])\n    .range([ 0, width ]);\n  svg.append(\"g\")\n    .attr(\"transform\", \"translate(0,\" + height + \")\")\n    .call(d3.axisBottom(x));\n \n  // Add Y axis\n  var y = d3.scaleLinear()\n    .domain([0, 500000])\n    .range([ height, 0]);\n  svg.append(\"g\")\n    .call(d3.axisLeft(y));\n \n  // Add dots\n  svg.append(\"g\")\n    .selectAll(\"dot\")\n    .data(dataD3)\n    .enter()\n    .append(\"circle\")\n      .attr(\"cx\", function (d) { return x(d.GrLivArea); } )\n      .attr(\"cy\", function (d) { return y(d.SalePrice); } )\n      .attr(\"r\", 1.5)\n      .style(\"fill\", \"#69b3a2\")\n \n})\n    \n}\n\n\n"]},"metadata":{},"sourceType":"module"}